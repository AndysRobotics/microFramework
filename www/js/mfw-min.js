const mfw={engine:"1.0.007",data:{},lastRender:0,maxLoopItterations:20,bindableAttributes:["data-if","data-for","data-innerHtml","data-switch","data-value","data-param","data-src","data-class","data-class-if"],getDataByPath:function(t=""){let e=this.data;if("."==t)return e;if(!t||!e)return;let a=t.split(".");for(let t of a){if(!e||"object"!=typeof e)return;if(void 0===e[t])return;e=e[t]}return e},setDataByPath:function(t="",e){if(!t||"string"!=typeof t)return;let a=t.split(".");if(!a.length)return;let r=this.data;if(1==a.length)r[a[0]]=e;else{for(let t=0;t<a.length-1;t++){let e=a[t];"object"!=typeof r[e]&&(r[e]={}),r=r[e]}r[a[a.length-1]]=e}},getDataFromInputGroup(t){if(!t||"string"!=typeof t)return{};let e={};for(let a of document.querySelectorAll('[data-group="'+t+'"]')){let t=a.name;t&&("checkbox"==a.type?e[t]=!!a.checked:e[t]=a.value)}return e},getElementIndex(t){if(!t||"function"!=typeof t.getAttribute)return null;for(;t;){let e=t.getAttribute("data-each-index");if(null!==e)return e;t=t.parentElement}return null},getDataFromElement(t){if(!t||"function"!=typeof t.getAttribute)return{index:null,api:null,timeout:null,param:null,groupData:{}};let e=t.getAttribute("data-param"),a=t.getAttribute("data-group"),r=t.getAttribute("data-timeout");return r=r&&Number(r)==r?Number(r):null,{index:this.getElementIndex(t),api:t.getAttribute("data-api"),timeout:r,param:this.getDataByPath(e),groupData:this.getDataFromInputGroup(a)}},showElement(t){t&&"function"==typeof t.getAttribute&&t.style&&(t.style.display=t.getAttribute("data-show")||"block")},hideElement(t){t&&"function"==typeof t.getAttribute&&t.style&&(t.style.display="none")},init:function(){this.render(),document.addEventListener("input",(t=>{this._handleDocumentInteraction(t)}))},render:function(){this._renderForLoops(),this._renderSwithes(),this._renderClassNames(),this._renderIfs(),this._renderInnerHtml(),this._renderImageSrcs(),this._renderInputValues(),this.lastRender=Date.now()},_handleDocumentInteraction:function(t){if(!t||!t.target||"function"!=typeof t.target.getAttribute)return;if("INPUT"!=t.target.tagName&&"TEXTAREA"!=t.target.tagName&&"SELECT"!=t.target.tagName)return;if(!t.target.getAttribute("data-value"))return;let e=t.target.getAttribute("data-value");if(!e)return;let a=t.target.value;"checkbox"==t.target.type&&(a=!!t.target.checked),this.getDataByPath(e)!==a&&(this.setDataByPath(e,a),this.render())},_testCondition:function(t){if(!t||"string"!=typeof t)return!1;if(this.getDataByPath(t))return!0;if("!"==t.charAt(0)&&!this.getDataByPath(t.substring(1)))return!0;let e=t.split("!=");return 2==e.length?this.getDataByPath(e[0])!=e[1]:(e=t.split(">="),2==e.length?this.getDataByPath(e[0])>=e[1]:(e=t.split("<="),2==e.length?this.getDataByPath(e[0])<=e[1]:(e=t.split("="),2==e.length?this.getDataByPath(e[0])==e[1]:(e=t.split("<"),2==e.length?this.getDataByPath(e[0])<e[1]:(e=t.split(">"),2==e.length&&this.getDataByPath(e[0])>e[1])))))},_renderForLoops:function(){let t=this,e="data-loop-processed";for(let t of document.querySelectorAll("[data-each-index]"))t.remove();for(let t of document.querySelectorAll("[data-for]"))t.removeAttribute(e);function a(t,e,a,r){if(!e||"function"!=typeof e.getAttribute||!a)return;let n=a.length,i=e.getAttribute(t);i==a?e.setAttribute(t,i+"."+r):!i||i.substring(0,n+1)!=a+"."&&i.substring(0,n+2)!="!"+a+"."||(i=i.replace(a+".",a+"."+r+"."),e.setAttribute(t,i))}function r(e,r,n){if(e&&"function"==typeof e.getAttribute)for(let i of t.bindableAttributes){a(i,e,r,n);for(let t of e.querySelectorAll(":scope ["+i+"]"))a(i,t,r,n)}}let n=0;for(;n<this.maxLoopItterations;){let t=!1;for(let a of document.querySelectorAll("[data-for]")){let n=a.getAttribute("data-for"),i=a.querySelectorAll(":scope > [data-each]");if(a.getAttribute(e))continue;a.setAttribute(e,!0),t=!0;let l=this.getDataByPath(n);if(i.length&&l&&l.length){for(let t=0;t<l.length;t++){let e=i[0].cloneNode(!0);e.setAttribute("data-each-index",t),e.removeAttribute("data-each"),r(e,n,t),a.appendChild(e)}this.showElement(a)}else this.hideElement(a)}if(!t)break;n++}for(let t of document.querySelectorAll("[data-for]"))t.removeAttribute(e);n==this.maxLoopItterations&&console.error("Max loop itterations reached")},_renderSwithes:function(){for(let t of document.querySelectorAll("[data-switch]")){let e=t.getAttribute("data-switch"),a=this.getDataByPath(e),r=!1;for(let e of t.querySelectorAll(":scope > [data-case]")){if(e.getAttribute("data-case")==a){r=!0,this.showElement(e);break}this.hideElement(e)}let n=t.querySelectorAll(":scope > [data-default]");n.length&&(r?this.hideElement(n[0]):(r=!0,this.showElement(n[0]))),r?this.showElement(t):this.hideElement(t)}},_renderIfs:function(){for(let t of document.querySelectorAll("[data-if]")){let e=t.getAttribute("data-if");this._testCondition(e)?this.showElement(t):this.hideElement(t)}},_renderInnerHtml:function(){for(let t of document.querySelectorAll("[data-innerHtml]")){let e=t.getAttribute("data-innerHtml"),a=this.getDataByPath(e);t.innerHTML=a||0===a||!1===a?"object"==typeof a?JSON.stringify(a,null,2):a:t.getAttribute("data-unknown")||""}},_renderImageSrcs:function(){for(let t of document.querySelectorAll("[data-src]")){let e=t.getAttribute("data-src"),a=this.getDataByPath(e);if(a&&"string"==typeof a)if(this.showElement(t),t.src){let e=new URL(t.src),r=e.pathname+e.search;r&&a==r||(t.src=a)}else t.src=a;else this.hideElement(t),t.src=""}},_renderClassNames:function(){for(let t of document.querySelectorAll("[data-class]")){let e=t.getAttribute("data-class");t.className=this.getDataByPath(e)||""}for(let t of document.querySelectorAll("[data-class-if]")){let e=t.getAttribute("data-class-if");if(!e||"string"!=typeof e)continue;let a=e.split(";");if(2!=a.length)continue;e=a[0];let r=a[1];t.classList.remove(r),this._testCondition(e)&&t.classList.add(r)}},_renderInputValues:function(){for(let t of document.querySelectorAll("[data-value]")){let e=t.getAttribute("data-value"),a=this.getDataByPath(e);void 0===a&&(a=t.getAttribute("data-unknown")),"checkbox"==t.type?a?(t.setAttribute("checked",""),t.checked=!0):(t.removeAttribute("checked"),t.checked=!1):t.value=a||""}}};