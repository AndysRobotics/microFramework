const mfw={engine:"1.0.009",data:{},lastRender:0,useDomPurify:"undefined"!=typeof DOMPurify&&"function"==typeof DOMPurify.sanitize,maxLoopItterations:20,bindableAttributes:["data-if","data-for","data-innerHtml","data-switch","data-value","data-param","data-src","data-class","data-class-if"],getDataByPath:function(t=""){let e=this.data;if("."==t)return e;if(!t||!e)return;let r=t.split(".");for(let t of r){if(!e||"object"!=typeof e)return;if(void 0===e[t])return;e=e[t]}return e},setDataByPath:function(t="",e){if(!t||"string"!=typeof t)return;let r=t.split(".");if(!r.length)return;let a=this.data;if(1==r.length)a[r[0]]=e;else{for(let t=0;t<r.length-1;t++){let e=r[t];"object"!=typeof a[e]&&(a[e]={}),a=a[e]}a[r[r.length-1]]=e}},getDataFromInputGroup(t){if(!t||"string"!=typeof t)return{};let e={};for(let r of document.querySelectorAll('[data-group="'+t+'"]')){let t=r.name;t&&("checkbox"==r.type?e[t]=!!r.checked:e[t]=r.value)}return e},getElementIndex(t){if(!t||"function"!=typeof t.getAttribute)return null;for(;t;){let e=t.getAttribute("data-each-index");if(null!==e)return e;t=t.parentElement}return null},getDataFromElement(t){if(!t||"function"!=typeof t.getAttribute)return{index:null,api:null,timeout:null,param:null,groupData:{}};let e=t.getAttribute("data-param"),r=t.getAttribute("data-group"),a=t.getAttribute("data-timeout");return a=a&&Number(a)==a?Number(a):null,{index:this.getElementIndex(t),api:t.getAttribute("data-api"),timeout:a,param:this.getDataByPath(e),groupData:this.getDataFromInputGroup(r)}},showElement(t){t&&"function"==typeof t.getAttribute&&t.style&&(t.style.display=t.getAttribute("data-show")||"block")},hideElement(t){t&&"function"==typeof t.getAttribute&&t.style&&(t.style.display="none")},init:function(){this.render(),document.addEventListener("input",(t=>{this._handleDocumentInteraction(t)}))},render:function(t=!0,e=!0){t&&this._renderForLoops(),e&&this._renderSwithes(),this._renderClassNames(),this._renderIfs(),this._renderInnerHtml(),this._renderImageSrcs(),this._renderInputValues(),this.lastRender=Date.now()},_handleDocumentInteraction:function(t){if(!t||!t.target||"function"!=typeof t.target.getAttribute)return;if("INPUT"!=t.target.tagName&&"TEXTAREA"!=t.target.tagName&&"SELECT"!=t.target.tagName)return;if(!t.target.getAttribute("data-value"))return;let e=t.target.getAttribute("data-value");if(!e)return;let r=t.target.value;"checkbox"==t.target.type&&(r=!!t.target.checked),this.getDataByPath(e)!==r&&(this.setDataByPath(e,r),this.render())},_testCondition:function(t){if(!t||"string"!=typeof t)return!1;if(this.getDataByPath(t))return!0;if("!"==t.charAt(0)&&!this.getDataByPath(t.substring(1)))return!0;let e=t.split("!=");return 2==e.length?this.getDataByPath(e[0])!=e[1]:(e=t.split(">="),2==e.length?this.getDataByPath(e[0])>=e[1]:(e=t.split("<="),2==e.length?this.getDataByPath(e[0])<=e[1]:(e=t.split("="),2==e.length?this.getDataByPath(e[0])==e[1]:(e=t.split("<"),2==e.length?this.getDataByPath(e[0])<e[1]:(e=t.split(">"),2==e.length&&this.getDataByPath(e[0])>e[1])))))},_renderForLoops:function(){let t=this,e="data-loop-processed";for(let t of document.querySelectorAll("[data-each-index]"))t.remove();for(let t of document.querySelectorAll("[data-for]"))t.removeAttribute(e);function r(t,e,r,a){if(!e||"function"!=typeof e.getAttribute||!r)return;let i=r.length,n=e.getAttribute(t);n==r?e.setAttribute(t,n+"."+a):!n||n.substring(0,i+1)!=r+"."&&n.substring(0,i+2)!="!"+r+"."||(n=n.replace(r+".",r+"."+a+"."),e.setAttribute(t,n))}function a(e,a,i){if(e&&"function"==typeof e.getAttribute)for(let n of t.bindableAttributes){r(n,e,a,i);for(let t of e.querySelectorAll(":scope ["+n+"]"))r(n,t,a,i)}}let i=0;for(;i<this.maxLoopItterations;){let t=!1;for(let r of document.querySelectorAll("[data-for]")){let i=r.getAttribute("data-for"),n=r.querySelectorAll(":scope > [data-each]");if(r.getAttribute(e))continue;r.setAttribute(e,!0),t=!0;let l=this.getDataByPath(i);if(n.length&&l&&l.length){for(let t=0;t<l.length;t++){let e=n[0].cloneNode(!0);e.setAttribute("data-each-index",t),e.removeAttribute("data-each"),a(e,i,t),r.appendChild(e)}this.showElement(r)}else this.hideElement(r)}if(!t)break;i++}for(let t of document.querySelectorAll("[data-for]"))t.removeAttribute(e);i==this.maxLoopItterations&&console.error("Max loop itterations reached")},_renderSwithes:function(){for(let t of document.querySelectorAll("[data-switch]")){let e=t.getAttribute("data-switch"),r=this.getDataByPath(e),a=!1;for(let e of t.querySelectorAll(":scope > [data-case]")){e.getAttribute("data-case")==r?(a=!0,this.showElement(e)):this.hideElement(e)}let i=t.querySelectorAll(":scope > [data-default]");i.length&&(a?this.hideElement(i[0]):(a=!0,this.showElement(i[0]))),a?this.showElement(t):this.hideElement(t)}},_renderIfs:function(){for(let t of document.querySelectorAll("[data-if]")){let e=t.getAttribute("data-if");this._testCondition(e)?this.showElement(t):this.hideElement(t)}},_renderInnerHtml:function(){this.useDomPurify="undefined"!=typeof DOMPurify&&"function"==typeof DOMPurify.sanitize;for(let t of document.querySelectorAll("[data-innerHtml]")){let e=t.getAttribute("data-innerHtml"),r=this.getDataByPath(e);r||0===r||!1===r?"object"==typeof r?t.innerHTML=JSON.stringify(r,null,2):this.useDomPurify&&r?t.innerHTML=DOMPurify.sanitize(r):t.innerHTML=r:t.innerHTML=t.getAttribute("data-unknown")||""}},_renderImageSrcs:function(){for(let t of document.querySelectorAll("[data-src]")){let e=t.getAttribute("data-src"),r=this.getDataByPath(e);if(r&&"string"==typeof r)if(this.showElement(t),t.src){let e=new URL(t.src),a=e.pathname+e.search;a&&r==a||(t.src=r)}else t.src=r;else this.hideElement(t),t.src=""}},_renderClassNames:function(){for(let t of document.querySelectorAll("[data-class]")){let e=t.getAttribute("data-class");t.className=this.getDataByPath(e)||""}for(let t of document.querySelectorAll("[data-class-if]")){let e=t.getAttribute("data-class-if");if(!e||"string"!=typeof e)continue;let r=e.split(";");if(2!=r.length)continue;e=r[0];let a=r[1];t.classList.remove(a),this._testCondition(e)&&t.classList.add(a)}},_renderInputValues:function(){for(let t of document.querySelectorAll("[data-value]")){let e=t.getAttribute("data-value"),r=this.getDataByPath(e);void 0===r&&(r=t.getAttribute("data-unknown"),this.setDataByPath(e,r)),"checkbox"==t.type?r?(t.setAttribute("checked",""),t.checked=!0):(t.removeAttribute("checked"),t.checked=!1):t.value=r||""}}};